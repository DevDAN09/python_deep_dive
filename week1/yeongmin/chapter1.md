# chapter1

매직 메서드는 언제 사용하는가?

- 파이썬 인터프리터가 호출하기 위해 사용
- 인터페이스 역할 → 사용자 친화적이지 않음

---

1. **객체 초기화와 생성**: **`__init__`**, **`__new__`**
    - **`__init__(self, ...)`**: 객체가 생성될 때 호출되며, 초기화를 담당
    - **`__new__(cls, ...)`**: 실제 객체가 메모리에 생성될 때 호출되며, **`__init__`**보다 먼저 실행
2. **객체 표현**: **`__str__`**, **`__repr__`**
    - **`__str__(self)`**: 객체를 읽기 편한 형태로 표현할 때 사용되며, **`str()`** 함수에 의해 호출
    - **`__repr__(self)`**: 객체를 개발자 친화적인 형태로 표현할 때 사용되며, 주로 디버깅 목적으로 사용
3. **연산자 오버로딩**: **`__add__`**, **`__sub__`**, **`__mul__`**, 등
    - 이 메서드들은 객체에 대한 수학적 연산을 커스터마이징. 예를 들어, **`__add__(self, other)`**는 두 객체의 덧셈(**`+`**) 연산을 정의
4. **컨테이너 메서드**: **`__getitem__`**, **`__setitem__`**, **`__len__`**
    - 이 메서드들은 객체가 컨테이너(리스트, 사전 등)처럼 동작하게 합니다. 예를 들어 **`__getitem__(self, key)`**은 **`self[key]`** 형태의 인덱싱에 대응
5. **Context 관리**: **`__enter__`**, **`__exit__`**
    - **`with`** 문과 함께 사용될 때 이 메서드들이 호출됩니다. 리소스 관리, 예외 처리 등의 목적으로 사용
    
    ### **`with` 문**
    
    **`with`** 문은 파이썬에서 리소스를 효율적으로 관리하기 위해 사용됩니다. 이는 파일, 네트워크 연결, 데이터베이스 세션 등의 리소스를 안전하게 사용하고, 작업 완료 후 자동으로 정리할 수 있도록 도와줌. **`with`** 문을 사용하면 리소스를 열고, 사용 후에 자동으로 정리(close)하는 과정을 보장할 수 있음
    
    ### **`__enter__` 메서드**
    
    - **`__enter__`** 메서드는 **`with`** 문이 시작될 때 자동으로 호출.
    - 이 메서드는 리소스를 초기화하거나 리소스에 대한 접근을 설정하는 데 사용.
    - **`__enter__`** 메서드는 **`with`** 문에 의해 사용될 리소스 객체를 반환
    
    ### **`__exit__` 메서드**
    
    - **`__exit__(self, exc_type, exc_val, exc_tb)`** 메서드는 **`with`** 문이 종료될 때 호출
    - 이 메서드는 리소스를 정리하는 데 사용 (예: 파일을 닫거나 네트워크 연결을 종료).
    - **`__exit__`** 메서드는 세 개의 인수를 받습니다: **`exc_type`**, **`exc_val`**, **`exc_tb`**. 이들은 **`with`** 블록 내에서 발생한 예외의 타입, 값, 트레이스백을 나타냄
    - 예외가 발생하지 않으면, 이 세 매개변수는 모두 **`None`**
    - **`__exit__`** 메서드는 예외가 처리되었음을 나타내기 위해 **`True`**를 반환할 수 있으며, 그렇지 않다면 **`False`** 또는 **`None`**을 반환
    
    ```jsx
    class File:
        def __init__(self, filename, mode):
            self.filename = filename
            self.mode = mode
    
        def __enter__(self):
            self.file = open(self.filename, self.mode)
            return self.file
    
        def __exit__(self, exc_type, exc_val, exc_tb):
            self.file.close()
            return False
    
    # 사용 예시
    with File('example.txt', 'r') as f:
        contents = f.read()
    # 여기서 파일은 자동으로 닫힙니다.
    ```
    
6. **호출 가능한 객체**: **`__call__`**
    - **`__call__(self, ...)`**: 객체가 함수처럼 호출될 수 있게 해줍니다. 예를 들어, **`obj()`** 형태로 객체를 호출하면 이 메서드가 실행

---

### **사용자 코드와 매직 메서드**

- **사용자 코드**: 개발자가 작성하는 일반적인 파이썬 코드입니다. 이 코드는 클래스, 함수, 변수 등을 정의하고, 라이브러리를 사용하며, 데이터를 처리하는 등의 작업을 포함
- **매직 메서드**: 특정 파이썬 문법이나 연산에 대응되는 메서드입니다. 예를 들어, 객체의 길이를 반환하는 **`__len__`** 메서드나 객체의 문자열 표현을 반환하는 **`__str__`** 메서드 등이 있습니다. 이 메서드들은 사용자가 직접 호출하기보다는, 파이썬 언어 자체의 구조에 의해 호출됩니다 (예: **`len()`** 함수나 **`str()`** 함수를 사용할 때).

### **내부 구현과의 연결**

- 매직 메서드는 파이썬의 내부적인 동작 방식과 연결되어 있습니다. 예를 들어, **`__getitem__`** 메서드는 객체에서 항목을 검색하는 연산(**`obj[key]`**)과 연결되어 있으며, 파이썬은 이 연산을 수행할 때 자동으로 이 메서드를 호출
- 이러한 방식으로, 매직 메서드는 파이썬의 추상화 수준을 높여, 개발자가 더 직관적이고 파이썬스러운(pythonic) 코드를 작성할 수 있도록 도와줄 수 있음

### 매직 메서드의 중요한 부분

1. **기본 제공 객체**: 파이썬의 기본 제공 데이터 타입(예: 리스트, 문자열, 사전)은 여러 매직 메서드를 이미 구현하고 있습니다. 예를 들어, 리스트는 **`__getitem__`**, **`__len__`** 등을 구현
2. **사용자 정의 객체**: 사용자가 정의한 클래스는 기본적으로 **`object`** 클래스를 상속받으며, **`object`** 클래스는 많은 기본적인 매직 메서드(예: **`__init__`**, **`__repr__`**, **`__str__`**)를 제공합니다. 사용자는 필요에 따라 이러한 메서드를 오버라이드(재정의)할 수 있음
3. **매직 메서드의 선택적 구현**: 객체가 특정 연산이나 동작을 지원하기 위해서는 관련된 매직 메서드를 구현해야 합니다. 예를 들어, 객체가 반복 가능(iterable)하게 만들고 싶다면 **`__iter__`**와 **`__next__`**를 구현해야 합니다. 하지만 모든 객체가 이러한 메서드를 구현할 필요는 없음
4. **비활성화된 매직 메서드**: 일부 매직 메서드는 특정 상황이나 객체 타입에 따라 비활성화될 수 있습니다. 예를 들어, 불변 객체는 **`__setitem__`** 같은 메서드를 구현하지 않음

---

### 객체가 반복가능하다라는 말의 의미

객체가 "반복 가능(iterable)"하다는 것은 해당 객체가 여러 번에 걸쳐 그 멤버를 하나씩 반환할 수 있다는 의미입니다. 파이썬에서는 리스트, 튜플, 문자열, 사전 등이 대표적인 반복 가능한 객체 이러한 객체들은 **`for`** 루프를 사용하여 각 요소에 대해 반복 작업을 수행할 수 있음

```jsx
class CountDown:
    def __init__(self, start):
        self.current = start

    def __iter__(self):
        return self

    def __next__(self):
        if self.current <= 0:
            raise StopIteration
        else:
            self.current -= 1
            return self.current
```

클래스는 주어진 시작 숫자부터 카운트다운하는 반복자를 구현합니다. **`__iter__`** 메서드는 자기 자신을 반환하고(**`self`**), **`__next__`** 메서드는 현재 숫자를 반환한 후 감소시킵니다. 숫자가 0 이하가 되면 **`StopIteration`** 예외를 발생시켜 반복을 멈춤

```jsx
countdown = CountDown(3)
for number in countdown:
    print(number)

countdown.__next__
```

### %r 에 대해서 중요함

포멧팅을 사용하여 값의 전달을 원할하게 진행

### **`__repr__`의 특징과 사용법:**

1. **개발자 친화적**: **`__repr__`** 메서드는 개발자가 객체를 이해하는 데 도움이 되는 방식으로 구현되어야 합니다. 일반적으로 이 메서드가 반환하는 문자열은 객체를 재생성할 수 있을 정도로 상세한 정보를 포함하는 것이 좋음
2. **객체의 "공식" 문자열 표현**: **`__repr__`**은 객체의 정확한 타입과 함께 필수 정보를 포함하여 객체를 "공식적으로" 표현하는데 사용
3. **재생성 가능한 출력**: 좋은 **`__repr__`** 구현의 예는 실행 가능한 코드 형태로 객체를 재생성할 수 있는 문자열을 반환하는 것입니다. 예를 들어, **`Point`** 클래스의 인스턴스에 대한 **`__repr__`**은 **`Point(1, 2)`**와 같은 형태를 반환할 수 있음
4. **내장 함수 `repr()`과의 연결**: 객체에 **`__repr__`** 메서드가 구현되어 있으면, **`repr()`** 함수를 호출했을 때 이 메서드가 반환하는 문자열이 결과값으로 사용

```jsx
class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y

    def __repr__(self):
        return f"Point({self.x}, {self.y})"
```

### **사용 상황:**

- **디버깅과 로깅**: 객체의 상태를 로그 파일에 기록하거나, 디버깅 중에 객체의 상태를 파악할 때 유용
- **개발자 콘솔**: 대화형 파이썬 콘솔에서 객체를 입력하면 **`__repr__`** 메서드가 자동으로 호출되어 객체를 설명하는 정보를 제공
- **시스템 출력**: 파이썬의 기본 구현은 일부 내장 타입에 대해 **`__repr__`**을 자동으로 호출하여, 객체를 문자열로 출력할 때 사용

**`__repr__`**은 객체의 정확하고 유용한 문자열 표현을 제공하여 프로그래밍의 편의성과 코드의 가독성을 높이는 데 중요한 역할

### **`%r`과 `%s`의 차이점:**

- **`%s`**도 문자열 포매팅에 사용되는 구문으로, 객체의 **`__str__()`** 메서드를 호출합니다. **`__str__()`**은 사용자 친화적인 문자열 표현을 제공하는 데 초점을 맞춤
- **`%r`**은 **`__repr__()`**을 호출하여 개발자 친화적인, 더 공식적이고 상세한 문자열 표현을 제공

**`%r`** 포매팅 스타일은 파이썬 2와 초기 파이썬 3 버전에서 많이 사용되었으나, 파이썬 3.6 이후로 도입된 f-문자열(f-string)과 **`str.format()`** 메서드가 더 현대적이고 가독성이 높은 대안으로 권장됨. 그럼에도 불구하고, **`%r`**은 여전히 유용한 도구이며, 특히 이전 코드베이스나 레거시 시스템에서 자주 봄